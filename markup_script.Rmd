---
title: "Assignment_5_Heinz_Konrad"
author: "K Heinz"
date: "1/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 3. Interacting with the API - the basics

The information is spread on 238 pages overall (page -> "totalPages" = 238").
total elements: content_viG[["page"]][["totalPages"]] --> 238
total elements:   content_viG[["page"]][["totalElements"]]  --> 4743

```{r first}

rm(list = ls())

if (!require("jsonlite")) install.packages("jsonlite")
if (!require("httr")) install.packages("httr")
if (!require("rlist")) install.packages("rlist")
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("naniar")) install.packages("naniar")

library(jsonlite)
library(httr)
library(rlist)
library(tidyverse)
library(naniar)

source("/home/weide/api_key.R")

base_url <- "https://app.ticketmaster.com/discovery/v2/"

get_url <- paste0(base_url, "venues.json?countryCode=DE&apikey=", apikey)

venues_in_Germany <- GET(get_url)
content_viG <- content(venues_in_Germany)


try_pag <- paste0(base_url, "venues.json?countryCode=DE&page=2&apikey=", apikey)
try_page <- GET(try_pag)
cont_try <- content(try_page)

n = 20

df_germany1 <-
  data.frame(
    name = character(n),
    city = character(n),
    postalCode = numeric(n),
    address = character(n),
    url = character(n),
    longitude = numeric(n),
    latitude = numeric(n),
    stringsAsFactors = FALSE
  )


for (i in seq(1,20)){
  
  id <- (content_viG[["_embedded"]][["venues"]])[[i]][["id"]]
  combined_url <- paste0(base_url, "venues/", id, ".json?apikey=", apikey )
  search_result <- GET(combined_url)
  cont_search_result <- content(search_result)
  
  df_germany1[i,1] <- cont_search_result$name
  df_germany1[i,2] <- cont_search_result$city$name
  df_germany1[i,3] <- cont_search_result$postalCode
  df_germany1[i,4] <- cont_search_result$address$line1
  df_germany1[i,5] <- cont_search_result$url
  if (("location" %in% names(cont_search_result)) == TRUE){
  df_germany1[i,6] <- cont_search_result$location$longitude
  df_germany1[i,7] <- cont_search_result$location$latitude
  }else { df_germany1[i,6] <- NaN
        df_germany1[i,7] <- NaN
  }

}


```

## 4. Interacting with the API - advanced




```{r first}

num <- as.numeric(content_viG[["page"]][["totalElements"]])
print(num)





df_germany <-
  data.frame(
    name = character(n),
    city = character(n),
    postalCode = numeric(n),
    address = character(n),
    url = character(n),
    longitude = numeric(n),
    latitude = numeric(n),
    stringsAsFactors = FALSE
  )



# The maximum number of items per request is limited to 25. 
# If we want to have more, we need to load it in in slices using a loop.
# Here an example to read in information on the first 125 items:

# for (i in 1:5) {
#   get_search_result <- GET(url = "http://api.walmartlabs.com/v1/search?",  
#                            query = list(apiKey = wal_key,
#                                         query = "chips",
#                                         numItems = 20,
#                                         start = ((i - 1) * 20 + 1)))
#   
#   json_parsed_search <- fromJSON(content(get_search_result, as = "text"))[["items"]]
#   
#   df_germany[((i - 1) * 20 + 1):(i * 20), ] <- json_parsed_search %>%
#     select(name, city, postalCode, address, url, longitude, latitude)
#   
# }
# 


```







You can also embed plots, for example:

```{r second}
```